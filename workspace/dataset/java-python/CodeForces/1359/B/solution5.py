if __name__ == "__main__":    t = int(input())    for case in range(t):        n,m,x,y = map(int, input().split())         grid = []         for _ in range(n):            grid.append(list(input()))                candidate, single_tile = 0,0         for i in range(n):            j = 0            while j < m:                if grid[i][j] == '.' and j+1 < m and grid[i][j+1] == '.':                    candidate += 2                    j += 2                elif grid[i][j] == '.':                    single_tile += 1                    j += 1                else:                    j += 1                if candidate & 1 == 1:            candidate -= 1            single_tile += 1                #print('single tiles = ', single_tile)        price = min((candidate//2)*y, candidate*x) + single_tile*x        print(price) 
