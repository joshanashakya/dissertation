import java.io.*;import java.util.*;public class Ishu{    static Scanner scan = new Scanner(System.in);    static BufferedWriter output = new BufferedWriter(new OutputStreamWriter(System.out));     static void tc() throws Exception    {    int n = scan.nextInt();    int[] a = new int[n + 1];    int i;    int[] b = new int[n + 1];    for(i=1;i<=n;++i)        a[i] = scan.nextInt();        int ans = 0;    for(i=2;i<n;++i)            {        if(a[i] > a[i-1] && a[i] > a[i+1])            b[i] = 1;        else if(a[i] < a[i-1] && a[i] < a[i+1])            b[i] = -1;                if(b[i] != 0)            ++ans;        }        int one = 0;    int two = 0;    int three = 0;        for(i=2;i<n;++i)        {        int pre = b[i-1];        int cur = b[i];        int next = b[i+1];        if(pre != 0 && next != 0)            {            if(cur != 0)                three = 3;            else                 one = 1;            }        else if(pre != 0 && next == 0)            {            if(cur == 1)                {                if((i + 2 <= n && a[i+2] == a[i+1]) || a[i-1] >= a[i+1] || i + 2 > n)                    two = 2;                else                    one = 1;                }            else if(cur == -1)                {                if((i + 2 <= n && a[i+2] == a[i+1]) || a[i-1] <= a[i+1] || i + 2 > n)                    two = 2;                else                    one = 1;                }                }        else if(pre == 0 && next != 0)            {            if(cur == 1)                {                if((i - 2 >= 1 && a[i-2] == a[i-1]) || a[i-1] <= a[i+1] || i - 2 == 0)                    two = 2;                else                    one = 1;                }            else if(cur == -1)                {                if((i - 2 >= 1 && a[i-2] == a[i-1]) || a[i-1] >= a[i+1] || i - 2 == 0)                    two = 2;                else                    one = 1;                }                }        else if(pre == 0 && next == 0)            {            if(cur != 0)                one = 1;            }        }            if(three == 3)        ans -= 3;    else if(two == 2)        ans -= 2;    else if(one == 1)        ans -= 1;        output.write(ans + "\n");    output.flush();    }    public static void main(String[] args) throws Exception    {    int t = 1;    t = scan.nextInt();    while(t-- > 0)        tc();    }}
